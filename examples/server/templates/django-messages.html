{% extends "base.html" %}
{% load djangular_tags tutorial_tags %}

{% block styles %}
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<link href="{{ STATIC_URL }}css/angular-toastr.css" rel="stylesheet" />
<link href="{{ STATIC_URL }}css/django-messages.css" rel="stylesheet" />
{% endblock styles %}

{% block container %}
<h1>Django Messages</h1>
<div class="row">
	<div class="col-md-12">
		<p class="lead">Ajax Django messages for AngularJS</p>
	</div>
</div>

<form {% block form_tag %}name="{{ form.form_name }}" ng-controller="MyFormCtrl" validate{% endblock %}>
	{% csrf_token %}
	<div class="row">
		<div class="col-md-12">
			{{ form.as_div }}
		</div>
	</div>
	<div class="row" style="margin-bottom: 20px;">
		<div class="col-md-12">
			<button type="button"
					class="btn btn-primary"
					ng-click="submit({{ form.scope_prefix }}, {{ form.form_name }})"
					ng-disabled="!{{ form.form_name }}.$dirty || {{ form.form_name }}.$invalid">Submit via Ajax</button>
		</div>
	</div>
</form>

<div class="row">
	<div class="col-md-12">
		<hr />
		<div class="djng-tutorial" ng-controller="TutorialCtrl">
			<h3>How does it work?</h3>

			<p ng-init="tabList=['Form', 'View', 'HTML', 'JavaScript']" class="lead">This example shows how to access Django Messages through Ajax in an AngularJS application.</p>
				
			<ul class="nav nav-tabs" role="tablist">
				<li ng-repeat="tab in tabList" ng-class="tabClass(tab)">
					<a ng-click="setTab(tab)" ng-bind="tab"></a>
				</li>
			</ul>
			
			<div ng-show="activeTab==='Form'">{% pygments "forms/django_messages.py" %}</div>
			<div ng-show="activeTab==='View'">{% pygments "views/django_messages.py" %}</div>
			<div ng-show="activeTab==='HTML'">{% pygments "tutorial/django-messages.html" %}</div>
			<div ng-show="activeTab==='JavaScript'">{% pygments "static/js/django-messages.js" %}</div>
			
		</div>
	</div>
</div>


{% endblock container %}

{% block scripts %}
	<script src="{{ STATIC_URL }}js/ng-django-forms.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL }}js/ng-django-messages.js" type="text/javascript"></script>
	<script type="text/javascript">
	var my_app = angular.module('djangular-demo', ['ng.django.forms', 'ng.django.messages', 'toastr']);
	my_app.config(function($httpProvider, toastrConfig) {
		$httpProvider.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
		$httpProvider.defaults.headers.common['X-CSRFToken'] = '{% csrf_value %}';
		$httpProvider.interceptors.push('djngMessagesInterceptor');
		
		/*
		 * change toastr styling to bootstrap
		 */
		angular.extend(toastrConfig, {
		    toastClass: 'alert',
		    iconClasses: {
		        error: 'alert-danger',
		        info: 'alert-info',
		        success: 'alert-success',
		        warning: 'alert-warning'
		    }
		});
	});
	</script>
	<script src="{{ STATIC_URL }}js/django-messages.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL }}js/angular-toastr.js" type="text/javascript"></script>
{% endblock %}